<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zula</title>
    <link rel="shortcut icon" type="image/x-icon" href="img/favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
</head>

<body class="bg-lines">
    <!--<div class="logo position-absolute top-50 start-50 translate-middle">
        <img src="img/logo.svg">
    </div>-->
    <div class="container vh-100 position-relative">
        <div class="row align-items-center justify-content-center vh-100">
            <div class="col-xl-10 text-center">

                <p>00:26</p>

                <!-- Grupo 1 -->
                <div class="row justify-content-center" style="min-height: 55px;">
                    <div class="col-auto">
                        <div class="title-words bg-violeta py-1 px-2 rounded-1">SEGURIDAD EN INTERNET</div>
                    </div>
                </div>
                <div class="js-sortable row gy-3 seguridad-active" id="grupo1">
                    <div class="col mb-3">
                        <div class="card sortable-item">
                            <div class="card-body text-center py-2 d-flex align-items-center justify-content-center">
                                HTTPS</div>
                        </div>
                    </div>
                    <div class="col mb-3">
                        <div class="card sortable-item">
                            <div class="card-body text-center py-2 d-flex align-items-center justify-content-center">MFA
                            </div>
                        </div>
                    </div>

                    <div class="col mb-3">
                        <div class="card sortable-item">
                            <div class="card-body text-center py-2 d-flex align-items-center justify-content-center">
                                Phishing</div>
                        </div>
                    </div>
                </div>

                <!-- Grupo 2 -->
                <div class="row justify-content-center" style="min-height: 55px;">
                    <div class="col-auto">
                        <div class="title-words bg-turquesa py-1 px-2 rounded-1">CONTRASEÑAS</div>
                    </div>
                </div>
                <div class="js-sortable row gy-3 contrasenas-active" id="grupo2">
                    <div class="col mb-3">
                        <div class="card sortable-item">
                            <div class="card-body text-center py-2 d-flex align-items-center justify-content-center">
                                Ransomware</div>
                        </div>
                    </div>
                    <div class="col mb-3">
                        <div class="card sortable-item">
                            <div class="card-body text-center py-2 d-flex align-items-center justify-content-center">
                                Spyware</div>
                        </div>
                    </div>

                    <div class="col mb-3">
                        <div class="card sortable-item">
                            <div class="card-body text-center py-2 d-flex align-items-center justify-content-center">
                                Keylogger</div>
                        </div>
                    </div>
                </div>

                <!-- Grupo 3 -->
                <div class="row justify-content-center" style="min-height: 55px;">
                    <div class="col-auto">
                        <div class="title-words bg-verde py-1 px-2 rounded-1">DISPOSITIVOS Y DATOS</div>
                    </div>
                </div>
                <div class="js-sortable row gy-3 dispositivos-active" id="grupo3">
                    <div class="col mb-3">
                        <div class="card sortable-item">
                            <div class="card-body text-center py-2 d-flex align-items-center justify-content-center">
                                Fuga de información</div>
                        </div>
                    </div>

                    <div class="col mb-3">
                        <div class="card sortable-item">
                            <div class="card-body text-center py-2 d-flex align-items-center justify-content-center">
                                Pérdida de datos</div>
                        </div>
                    </div>
                    <div class="col mb-3">
                        <div class="card sortable-item">
                            <div class="card-body text-center py-2 d-flex align-items-center justify-content-center">
                                Complejidad</div>
                        </div>
                    </div>
                </div>

                <!-- Grupo 4 
                <div class="title-words bg-naranja mx-auto mb-0 py-1 px-2 rounded-1 mb-2">MALWARE</div>
                <div class="js-sortable row gy-3 malware-active" id="grupo4">
                    <div class="col mb-3">
                        <div class="card sortable-item">
                            <div class="card-body text-center py-2 d-flex align-items-center justify-content-center">VPN
                            </div>
                        </div>
                    </div>
                    <div class="col mb-3">
                        <div class="card sortable-item">
                            <div class="card-body text-center py-2 d-flex align-items-center justify-content-center">
                                Frase secreta</div>
                        </div>
                    </div>
                    <div class="col mb-3">
                        <div class="card sortable-item">
                            <div class="card-body text-center py-2 d-flex align-items-center justify-content-center">
                                Configuración débil</div>
                        </div>
                    </div>
                    <div class="col mb-3">
                        <div class="card sortable-item">
                            <div class="card-body text-center py-2 d-flex align-items-center justify-content-center">
                                Autenticación fuerte</div>
                        </div>
                    </div>
                </div>-->

            </div>
        </div>
    </div>


    <!-- Scripts: bootstrap + Sortable (igual que tenías) -->
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/Sortable.min.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const warningEl = document.getElementById('limitWarning');
            let warnTimer = null;
            function showWarning(msg) {
                if (!warningEl) return;
                warningEl.textContent = msg;
                warningEl.style.display = 'block';
                clearTimeout(warnTimer);
                warnTimer = setTimeout(() => { warningEl.style.display = 'none'; }, 1400);
            }

            document.querySelectorAll('.js-sortable').forEach(el => {
                new Sortable(el, {
                    animation: 150,
                    group: {
                        name: 'shared',
                        pull: true,
                        put: true
                    },
                    sort: false,           // no reordenar dentro del mismo contenedor (evita reorden horizontal)
                    direction: 'vertical', // fuerza movimiento vertical entre grupos
                    forceFallback: true,
                    draggable: '.col',
                    chosenClass: "sortable-chosen",
                    ghostClass: "sortable-ghost",

                    onStart() {
                        document.body.classList.add("sortable-dragging");
                    },

                    onEnd() {
                        document.body.classList.remove("sortable-dragging");
                    },

                    /**
                     * onAdd: se dispara cuando el item ya fue insertado en el destino.
                     * Aquí hacemos el "swap": si el grupo destino tenía 4 antes (ahora tiene 5),
                     * sacamos la card que fue desplazada por la inserción y la volvemos a insertar
                     * en el origen en la posición original (evt.oldIndex). Así queda siempre 4 en cada grupo.
                     */
                    onAdd(evt) {
                        const to = evt.to;     // contenedor destino
                        const from = evt.from; // contenedor origen
                        const item = evt.item; // la .col insertada
                        // cantidad luego de la inserción
                        const afterCount = to.querySelectorAll('.col').length;
                        const beforeCount = afterCount - 1;

                        // Si antes ya había 4 cards en destino => necesitamos hacer swap
                        if (beforeCount >= 3) {
                            // evt.newIndex es el índice donde fue insertado el 'item' dentro de 'to'
                            // El elemento que fue desplazado era el que estaba en ese mismo índice antes de insertar.
                            // Después de insertar, ese elemento pasó a index = evt.newIndex + 1 (si existe).
                            let replacedIndex = (typeof evt.newIndex === 'number' && evt.newIndex >= 0) ? evt.newIndex + 1 : to.children.length - 1;

                            // Por seguridad, recortamos dentro del rango
                            if (replacedIndex >= to.children.length) replacedIndex = to.children.length - 1;

                            const replaced = to.children[replacedIndex];

                            // Si encontramos el reemplazado y no es el mismo item, lo movemos al origen.
                            if (replaced && replaced !== item) {
                                // Insertar el reemplazado en la posición original del origen (evt.oldIndex)
                                // evt.oldIndex puede ser -1 en ciertos navegadores; en ese caso lo agregamos al final.
                                const ref = (typeof evt.oldIndex === 'number' && evt.oldIndex >= 0) ? (from.children[evt.oldIndex] || null) : null;
                                // quitamos el reemplazado del destino y lo insertamos en el origen
                                from.insertBefore(replaced, ref);

                                // Si quisieras mostrar feedback:
                                // showWarning('Intercambio realizado — se mantiene 4 por grupo.');
                            } else {
                                // caso borde: no encontramos reemplazado (insert at end) -> simplemente devolver
                                // movemos el item de vuelta al origen
                                const ref = (typeof evt.oldIndex === 'number' && evt.oldIndex >= 0) ? (from.children[evt.oldIndex] || null) : null;
                                from.insertBefore(item, ref);
                                showWarning('No se pudo intercambiar en esa posición.');
                            }
                        }

                        // Aseguramos que siempre haya exactamente 4 por grupo (protección adicional)
                        // Si por alguna razón quedó distinto, lo corregimos moviendo extras al origen
                        const toCols = to.querySelectorAll('.col');
                        if (toCols.length > 3) {
                            // devolver los extra(s) al origen (últimos)
                            while (to.querySelectorAll('.col').length > 3) {
                                const last = to.querySelectorAll('.col')[to.querySelectorAll('.col').length - 1];
                                const ref = (typeof evt.oldIndex === 'number' && evt.oldIndex >= 0) ? (from.children[evt.oldIndex] || null) : null;
                                from.insertBefore(last, ref);
                                showWarning('Cada grupo admite máximo 3 cards.');
                            }
                        }
                    },

                    /**
                     * onMove: bloqueo preventivo. Si el origen quedaría con menos de 4 bloqueamos el movimiento.
                     * Esto evita que al arrastrar desde un grupo con exactamente 4 items, el drag sea inválido.
                     */
                    onMove(evt) {
                        const from = evt.from;
                        const to = evt.to;
                        const fromCount = from.querySelectorAll('.col').length;
                        const toCount = to.querySelectorAll('.col').length;

                        // Si origen tiene 4 y estamos intentando arrastrar fuera => ok solo si destino puede reemplazar
                        // Permitir el drag si el destino tiene al menos 1 card (siempre reemplazaremos)
                        // Bloquear solo si origen quedaría con menos de 4 (es decir, si fromCount <= 4) AND destino no puede recibir (caso borde)
                        if (fromCount <= 3 && from !== to) {
                            // allow move — la lógica de swap la maneja onAdd
                            return true;
                        }

                        // Default allow
                        return true;
                    }

                });
            });
        });
    </script>




</body>

</html>